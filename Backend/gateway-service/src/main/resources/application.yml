server:
  port: 8080

spring:
  application:
    name: gateway-service

  cloud:
    gateway:
      # default-filters:
      #   - RemoveHopByHopHeaders=
      routes:
        - id: appointments-route
          uri: lb://appointment-service
          predicates:
            - Path=/api/appointments/**
          filters:
            - StripPrefix=1
        - id: prescriptions-route
          uri: lb://appointment-service
          predicates:
            - Path=/api/prescriptions/**
          filters:
            - StripPrefix=1
        - id: auth-route
          uri: lb://auth-service
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1
        - id: admin-route
          uri: lb://auth-service
          predicates:
            - Path=/api/admin/**
          filters:
            - StripPrefix=1
        - id: records-route
          uri: lb://medical-record-service
          predicates:
            - Path=/api/records/**
          filters:
            - StripPrefix=1
        - id: audit-route
          uri: lb://audit-service
          predicates:
            - Path=/api/audit/**
          filters:
            - StripPrefix=1
        - id: mail-route
          uri: lb://mail-service
          predicates:
            - Path=/api/mail/**
          filters:
            - StripPrefix=1
        - id: ml-route
          uri: lb://ml-service
          predicates:
            - Path=/api/ml/**
          filters:
            - StripPrefix=1
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: ${app.cors.allowed-origins:["http://localhost:3000","http://localhost:3001"]}
            allowedMethods: ["GET","POST","PUT","PATCH","DELETE","OPTIONS"]
            allowedHeaders: ["*"]
            exposedHeaders: ["*"]
            allowCredentials: true
            maxAge: 3600

  security:
    oauth2:
      resourceserver:
        jwt:
          # Provide your Keycloak realm issuer and JWK set URIs (Docker-friendly defaults)
          issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8180/realms/medinsight}
          jwk-set-uri: ${KEYCLOAK_JWK_SET_URI:http://keycloak:8080/realms/medinsight/protocol/openid-connect/certs}

eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: ${EUREKA_CLIENT_SERVICEURL_DEFAULTZONE:http://discovery-service:8761/eureka/}
  instance:
    prefer-ip-address: true

# Springdoc OpenAPI
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    urls:
      - name: auth-service
        url: /api/auth/v3/api-docs
      - name: appointment-service
        url: /api/appointments/v3/api-docs
      - name: medical-record-service
        url: /api/records/v3/api-docs
      - name: audit-service
        url: /api/audit/v3/api-docs
      - name: mail-service
        url: /api/mail/v3/api-docs
      - name: ml-service
        url: /api/ml/v3/api-docs
  api-docs:
    path: /v3/api-docs

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when_authorized

# Custom app configuration
app:
  cors:
    # List of allowed origins for CORS (React frontend, etc.)
    allowed-origins:
      - http://localhost:3000

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    org.springframework.http.server.reactive: DEBUG
    org.springframework.web.reactive: DEBUG
    reactor.netty: DEBUG
